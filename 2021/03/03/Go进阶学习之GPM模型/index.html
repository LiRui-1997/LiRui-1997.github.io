<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Go进阶学习之GPM模型 | 李瑞的个人博客</title><meta name="description" content="进程&#x2F;线程&#x2F;协程对比进程：进程是系统进行资源分配的基本单位，有独立的内存空间。 线程：线程是CPU调度和分配的基本单位，线程依附于进程存在，每个线程会共享父进程的资源。 协程：协程是一种用户态的轻量级线程，协程的调度完全由用户控制，协程间切换只需要保存任务的上下文，没有内核的开销。 线程上下文切换，由于中断处理，多任务处理，用户态切换的原因会导致CPU从一个线程切换到另一个线程，切换过程需要保存当"><meta name="keywords" content="Golang,GMP模型"><meta name="author" content="李瑞"><meta name="copyright" content="李瑞"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://lirui-1997.github.io/2021/03/03/Go%E8%BF%9B%E9%98%B6%E5%AD%A6%E4%B9%A0%E4%B9%8BGPM%E6%A8%A1%E5%9E%8B/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta property="og:type" content="article"><meta property="og:title" content="Go进阶学习之GPM模型"><meta property="og:url" content="https://lirui-1997.github.io/2021/03/03/Go%E8%BF%9B%E9%98%B6%E5%AD%A6%E4%B9%A0%E4%B9%8BGPM%E6%A8%A1%E5%9E%8B/"><meta property="og:site_name" content="李瑞的个人博客"><meta property="og:description" content="进程&#x2F;线程&#x2F;协程对比进程：进程是系统进行资源分配的基本单位，有独立的内存空间。 线程：线程是CPU调度和分配的基本单位，线程依附于进程存在，每个线程会共享父进程的资源。 协程：协程是一种用户态的轻量级线程，协程的调度完全由用户控制，协程间切换只需要保存任务的上下文，没有内核的开销。 线程上下文切换，由于中断处理，多任务处理，用户态切换的原因会导致CPU从一个线程切换到另一个线程，切换过程需要保存当"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/LiRui-1997/hexo/image/封面/微信图片_20200922105439.png"><meta property="article:published_time" content="2021-03-03T01:37:22.000Z"><meta property="article:modified_time" content="2021-03-05T03:46:24.861Z"><meta name="twitter:card" content="summary"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><script>var GLOBAL_CONFIG = { 
  root: '/',
  hexoversion: '5.1.1',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime: '',
  date_suffix: {"one_hour":"刚刚","hours":"小时前","day":"天前"},
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  justifiedGallery: {
    js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
    css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
  },
  baiduPush: false,
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
};

var saveToLocal = {
  set: function setWithExpiry(key, value, ttl) {
      const now = new Date()
      const expiryDay = ttl * 86400000
      const item = {
        value: value,
        expiry: now.getTime() + expiryDay,
      }
      localStorage.setItem(key, JSON.stringify(item))
    },
  
  get: function getWithExpiry(key) {
    const itemStr = localStorage.getItem(key)

    if (!itemStr) {
      return undefined
    }
    const item = JSON.parse(itemStr)
    const now = new Date()

    if (now.getTime() > item.expiry) {
      localStorage.removeItem(key)
      return undefined
    }
    return item.value
  }
}</script><script id="config_change">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isSidebar: true,
  postUpdate: '2021-03-05 11:46:24'
}</script><noscript><style type="text/css">
#nav {
  opacity: 1
}
.justified-gallery img {
  opacity: 1
}
</style></noscript><script>var activateDarkMode = function () {
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
  }
}
var activateLightMode = function () {
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
  }
}

var autoChangeMode = 'false'
var t = saveToLocal.get('theme')
if (autoChangeMode === '1') {
  var isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
  var isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
  var isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined) {
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport) {
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour <= 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
    }
    window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
      if (saveToLocal.get('theme') === undefined) {
        e.matches ? activateDarkMode() : activateLightMode()
      }
    })
  } else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else if (autoChangeMode === '2') {
  now = new Date()
  hour = now.getHours()
  isNight = hour <= 6 || hour >= 18
  if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else {
  if (t === 'dark') activateDarkMode()
  else if (t === 'light') activateLightMode()
}</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/LiRui-1997/hexo/StaticFile_Hexo-master/butterfly/css/pool.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/LiRui-1997/hexo/StaticFile_Hexo-master/butterfly/css/iconfont.min.css"><meta name="generator" content="Hexo 5.1.1"></head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/null" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">28</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">30</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 清单</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div id="body-wrap"><div id="sidebar"><i class="fas fa-arrow-right on" id="toggle-sidebar"></i><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%9B%E7%A8%8B-%E7%BA%BF%E7%A8%8B-%E5%8D%8F%E7%A8%8B%E5%AF%B9%E6%AF%94"><span class="toc-number">1.</span> <span class="toc-text">进程&#x2F;线程&#x2F;协程对比</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B0%83%E5%BA%A6%E5%99%A8%E5%AE%9E%E7%8E%B0%E6%9C%BA%E5%88%B6"><span class="toc-number">2.</span> <span class="toc-text">调度器实现机制</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B0%83%E5%BA%A6%E8%BF%87%E7%A8%8B"><span class="toc-number">3.</span> <span class="toc-text">调度过程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B0%83%E5%BA%A6%E7%AD%96%E7%95%A5"><span class="toc-number">4.</span> <span class="toc-text">调度策略</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%BB%E5%8A%A1%E7%AA%83%E5%8F%96%EF%BC%88work-stealing%EF%BC%89"><span class="toc-number">4.1.</span> <span class="toc-text">任务窃取（work-stealing）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%87%8F%E5%B0%91%E9%98%BB%E5%A1%9E"><span class="toc-number">4.2.</span> <span class="toc-text">减少阻塞</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Goroutine%E7%8A%B6%E6%80%81"><span class="toc-number">5.</span> <span class="toc-text">Goroutine状态</span></a></li></ol></div></div></div><header class="post-bg" id="page-header" style="background-image: url(https://cdn.jsdelivr.net/gh/LiRui-1997/hexo/image/封面/微信图片_20200922105439.png)"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">李瑞的个人博客</a></span><span id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 清单</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><span class="close" id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></span></span></nav><div id="post-info"><div id="post-title"><div class="posttitle">Go进阶学习之GPM模型</div></div><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2021-03-03T01:37:22.000Z" title="发表于 2021-03-03 09:37:22">2021-03-03</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2021-03-05T03:46:24.861Z" title="更新于 2021-03-05 11:46:24">2021-03-05</time></span></div><div class="meta-secondline"> <span class="post-meta-separator">|</span><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><h2 id="进程-线程-协程对比"><a href="#进程-线程-协程对比" class="headerlink" title="进程/线程/协程对比"></a>进程/线程/协程对比</h2><p>进程：进程是系统进行资源分配的基本单位，有独立的内存空间。</p>
<p>线程：线程是CPU调度和分配的基本单位，线程依附于进程存在，每个线程会共享父进程的资源。</p>
<p>协程：<strong>协程是一种用户态的轻量级线程</strong>，协程的调度完全由用户控制，协程间切换只需要保存任务的上下文，没有内核的开销。</p>
<p><strong>线程上下文切换</strong>，由于中断处理，多任务处理，用户态切换的原因会导致CPU从一个线程切换到另一个线程，切换过程需要保存当前进程的状态并恢复另一个进程的状态。<strong>上下文切换的代价是高昂的</strong>，因为在核心上交换线程会花费很多时间。上下文切换的延迟取决于不同的因素，大概在50到100纳秒之间。考虑到硬件平均在每个核心上每纳秒执行12条指令，那么一次上下文切换可能会花费600到1200条指令的延迟时间。实际上，上下文切换占用了大量程序执行指令的时间。如果存在<strong>跨核上下文切换</strong>（Cross-Core Context Switch），可能会导致CPU缓存失效（CPU从缓存访问数据的成本大约3到40个时钟周期，从主存访问数据的成本大约100到300个时钟周期），这种场景的切换成本会更加昂贵。</p>
<p><strong>Goroutine非常轻量</strong>，主要体现在一下两个方面：</p>
<ol>
<li><strong>上下文切换代价小</strong>。Goroutine上下文切换只涉及三个寄存器（PC/SP/DX）的值修改；而对比线程的上下文切换则需要涉及模式切换（从用户态切换到内核态）、以及16个寄存器、PC、SP…等寄存器的刷新；</li>
<li><strong>内存占用小</strong>：线程栈空间通常是2M，Goroutine栈空间最小2K；</li>
</ol>
<p>Golang 程序中可以轻松支持<strong>10w 级别</strong>的Goroutine运行，而线程数量达到1k时，内存占用就已经达到2G。</p>
<h2 id="调度器实现机制"><a href="#调度器实现机制" class="headerlink" title="调度器实现机制"></a>调度器实现机制</h2><p>Go调度器模型通常叫做<strong>G-P-M模型</strong>，他包括4个重要结果，分别是<strong>G、P、M、Sched</strong>：</p>
<ul>
<li><strong>G: Goroutine</strong>，每个Goroutine对应一个G结构体，G存储Goroutine的运行堆栈、状态以及任务函数，可重用。G并非执行体，每个G需要绑定到P才能被调度执行。</li>
<li><strong>P: Processor</strong>，表示逻辑处理器，对G来说，P相当于CPU核，G只有绑定到P才能被调度。对M来说，P提供了相关的执行环境（Context），如内存分配状态（mcache），任务队列（G）等。P的数量决定了系统内最大可并行的G的数量（前提：物理CPU核数 &gt;= P的数量）。<strong>P的数量由用户设置的GoMAXPROCS决定，但是不论GoMAXPROCS设置为多大，P的数量最大为256</strong>。</li>
<li><strong>M: Machine</strong>，OS内核线程抽象，代表着真正执行计算的资源，在绑定有效的P后，进入schedule循环；而schedule循环的机制大致是从Global队列、P的Local队列以及wait队列中获取。<strong>M的数量是不定的，由Go Runtime调整</strong>，为了防止创建过多的OS线程导致系统调度不过来，目前默认最大限制为10000个。M并不保留G状态，这是G可以跨M调度的基础。</li>
<li><strong>Sched: Go 调度器</strong>，它维护有存储M和G的队列以及调度的一些状态信息等。</li>
</ul>
<p>调度器循环的机制大致是从各种队列、P的本地队列中获取G，切换到G的执行栈上并执行G的函数，调用Goexit做清理工作并回到M，如此反复。</p>
<h2 id="调度过程"><a href="#调度过程" class="headerlink" title="调度过程"></a>调度过程</h2><p>当通过 go 关键字创建一个新的 goroutine 的时候，它会<strong>优先</strong>被放入 P 的本地队列。为了运行 goroutine，M 需要持有（绑定）一个 P，接着 M 会启动一个 OS 线程，循环从 P 的本地队列里取出一个 goroutine 并执行。执行调度算法：当 M 执行完了当前 P 的 Local 队列里的所有 G 后，P 也不会就这么在那划水啥都不干，它会先尝试从 Global 队列寻找 G 来执行，如果 Global 队列为空，它会随机挑选另外一个 P，从它的队列里中拿走一半的 G 到自己的队列中执行。</p>
<p><img src="https://cdn.jsdelivr.net/gh/LiRui-1997/hexo/image/Go%E8%BF%9B%E9%98%B6%E5%AD%A6%E4%B9%A0%E4%B9%8BGPM%E6%A8%A1%E5%9E%8B/image-20210303110826655.png" alt="image-20210303110826655"></p>
<ol>
<li>每个P维护一个G的本地队列；</li>
<li>每当一个G被创建出来，或者变为可执行状态时，就把他放到P的本地可执行队列中，如果满了则放入Global；</li>
<li>当一个G在M里执行结束后，P会从队列中把该G取出；如果此时P的队列为空，即没有其他G可以执行，M就随机选择另外一个P，从其中可执行的G队列中取走一半。</li>
</ol>
<h2 id="调度策略"><a href="#调度策略" class="headerlink" title="调度策略"></a>调度策略</h2><h3 id="任务窃取（work-stealing）"><a href="#任务窃取（work-stealing）" class="headerlink" title="任务窃取（work-stealing）"></a>任务窃取（work-stealing）</h3><p>我们知道，现实情况有的 Goroutine 运行的快，有的慢，那么势必肯定会带来的问题就是，忙的忙死，闲的闲死，Go 肯定不允许摸鱼的 P 存在，势必要充分利用好计算资源。</p>
<p>为了提高 Go 并行处理能力，调高整体处理效率，当每个 P 之间的 G 任务不均衡时，调度器允许从 GRQ（全局运行队列），或者其他 P 的 LRQ （本地运行队列）中获取 G 执行。</p>
<h3 id="减少阻塞"><a href="#减少阻塞" class="headerlink" title="减少阻塞"></a>减少阻塞</h3><p>如果正在执行的Goroutine阻塞了线程M怎么把办？P上LRQ中的Goroutine会获取不到调度么？</p>
<p><strong>场景1：由于原子、互斥量或通道操作调用导致Goroutine阻塞</strong>，调度器将把当前阻塞的Goroutine切换出去，重新调度LRQ上的其他Goroutine；</p>
<p><strong>场景2：由于网络请求和IO操作导致Goroutine阻塞</strong>，在这种阻塞的情况下，我们的G和M又会怎么做呢？</p>
<p><strong>场景3：</strong>当调用一些系统方法的时候，如果系统方法调用的时候发生阻塞，在这种情况下，网络轮询器（NetPoller）无法使用，而进行系统调用的Goroutine将阻塞当前M；</p>
<p><strong>场景4：</strong>如果在Goroutine去执行一个sleep操作，导致M被阻塞了。</p>
<p>这四种场景又可归类为两种类型：</p>
<p><strong>1. 用户态阻塞/唤醒：</strong>当 goroutine 因为 channel 操作阻塞时，对应的 G 会被放置到某个 wait 队列(如 channel 的 waitq)，该 G 的状态由<code>_Gruning</code> 变为 <code>_Gwaitting</code> ，而 M 会跳过该 G 尝试获取并执行下一个 G，如果此时没有 runnable 的 G 供 M 运行，那么 M 将解绑 P，并进入 sleep 状态；当阻塞的 G 被另一端的 G2 唤醒时（比如 channel 的可读/写通知），G 被标记为 runnable，尝试加入 G2 所在 P 的 runnext，然后再是 P 的 Local 队列和 Global 队列。</p>
<p><strong>2. 系统调用阻塞：</strong>当 G 被阻塞在某个系统调用上时，此时 G 会阻塞在 <code>_Gsyscall</code> 状态，M 也处于 <code>block on syscall</code> 状态，此时的 M 可被抢占调度：执行该 G 的 M 会与 P 解绑，而 P 则尝试与其它空闲的 M 绑定，继续执行其它 G。如果没有其它空闲的 M，但 P 的 Local 队列中仍然有 G 需要执行，则创建一个新的 M；当系统调用完成后，G 会重新尝试获取一个空闲的 P 进入它的 Local 队列恢复执行，如果没有空闲的 P，G 会被标记为 runnable 加入到 Global 队列。</p>
<p>针对以上场景，主要针对场景二进行阐述说明：</p>
<p>当出现大量网络请求和IO操作导致Goroutine阻塞，Go提供了网络轮询器（NetPoller）来处理网络请求和IO操作，通过epoll实现IO多路复用。</p>
<p>通过使用NetPoller进行网络系统调用，调度器可以防止Goroutine在进行这些系统调用时阻塞M。这可以让M执行P的LRQ中的其他Goroutines，而不需要创建新的M。有助于减少操作系统上的调度负载。</p>
<p><img src="https://cdn.jsdelivr.net/gh/LiRui-1997/hexo/image/Go%E8%BF%9B%E9%98%B6%E5%AD%A6%E4%B9%A0%E4%B9%8BGPM%E6%A8%A1%E5%9E%8B/image-20210303113205179.png" alt="image-20210303113205179"></p>
<p>如上图，G1想要进行网络系统调用，因此它被移动到网络轮询器并且处理异步网络系统调用。然后，M可以从LRQ执行另外的Goroutine。此时，G2就被上下文切换到M上了。</p>
<p><img src="https://cdn.jsdelivr.net/gh/LiRui-1997/hexo/image/Go%E8%BF%9B%E9%98%B6%E5%AD%A6%E4%B9%A0%E4%B9%8BGPM%E6%A8%A1%E5%9E%8B/image-20210303113355031.png" alt="image-20210303113355031"></p>
<p>最后，异步网络系统调用由网络轮询器完成，G1被移回到P的LRQ中。一旦G1可以再M上进行上下文切换，它负责的Go相关代码就可以再次执行。这里的最大优势是，执行网络系统调用不需要额外的M。网络轮询器使用系统线程，它时刻处理一个有效的事件循环。</p>
<p><strong>总之，原理是Go runtime中的netpoller通过非阻塞socket和IO多路复用机制模拟出来，Go中的net库即按照这种方式实现。</strong></p>
<h2 id="Goroutine状态"><a href="#Goroutine状态" class="headerlink" title="Goroutine状态"></a>Goroutine状态</h2><p><img src="https://cdn.jsdelivr.net/gh/LiRui-1997/hexo/image/Go%E8%BF%9B%E9%98%B6%E5%AD%A6%E4%B9%A0%E4%B9%8BGPM%E6%A8%A1%E5%9E%8B/image-20210303114832196.png" alt="image-20210303114832196"></p>
<p><strong>注意，goroutine状态转换时两个重要方法，gopark()、goready()</strong></p>
</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://lirui-1997.github.io/">李瑞</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://lirui-1997.github.io/2021/03/03/Go%E8%BF%9B%E9%98%B6%E5%AD%A6%E4%B9%A0%E4%B9%8BGPM%E6%A8%A1%E5%9E%8B/">https://lirui-1997.github.io/2021/03/03/Go%E8%BF%9B%E9%98%B6%E5%AD%A6%E4%B9%A0%E4%B9%8BGPM%E6%A8%A1%E5%9E%8B/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用  <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0 </a> 许可协议。转载请注明出处！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Golang/">Golang</a><a class="post-meta__tags" href="/tags/GMP%E6%A8%A1%E5%9E%8B/">GMP模型</a></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/gh/LiRui-1997/hexo/image/封面/微信图片_20200922105439.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2021/03/03/Golang%E8%BF%9B%E9%98%B6%E5%AD%A6%E4%B9%A0%E4%B9%8B%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3panic%E5%92%8Crecover/"><img class="prev-cover" src="https://cdn.jsdelivr.net/gh/LiRui-1997/hexo/image/封面/微信图片_20200922105439.png" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Golang进阶学习之深入理解panic和recover</div></div></a></div><div class="next-post pull-right"><a href="/2020/10/16/Go%E6%A8%A1%E5%9D%97/"><img class="next-cover" src="https://cdn.jsdelivr.net/gh/LiRui-1997/hexo/image/封面/微信图片_20200922105439.png" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Golang开发之Go Modules</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> 相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2020/10/16/GO开发者学习路线-md/" title="GO开发者学习路线"><img class="cover" src="https://cdn.jsdelivr.net/gh/LiRui-1997/hexo/image/封面/微信图片_20200922105439.png"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-10-16</div><div class="title">GO开发者学习路线</div></div></a></div><div><a href="/2020/10/16/Go模块/" title="Golang开发之Go Modules"><img class="cover" src="https://cdn.jsdelivr.net/gh/LiRui-1997/hexo/image/封面/微信图片_20200922105439.png"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-10-16</div><div class="title">Golang开发之Go Modules</div></div></a></div><div><a href="/2021/03/04/Go进阶学习之同步锁/" title="Go进阶学习之同步锁"><img class="cover" src="https://cdn.jsdelivr.net/gh/LiRui-1997/hexo/image/封面/微信图片_20200922105439.png"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-03-04</div><div class="title">Go进阶学习之同步锁</div></div></a></div></div></div></article></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2021 By 李瑞</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><section id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></section><div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><div class="js-pjax"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script src="https://cdn.jsdelivr.net/gh/LiRui-1997/hexo/StaticFile_Hexo-master/butterfly/js/pool.min.js"></script><canvas class="fireworks"></canvas><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="/js/third-party/fireworks.js"></script></div></body></html>